<%- include('partials/header', { title: 'Tambah Laporan' }) %>

<section>
  <a href="/laporan" class="btn small btn primary"><i class="bi bi-arrow-left"></i>Kembali</a>
  <h2>Tambah Laporan</h2>

  <% 
    const namaOptions = ['Amin', 'Ludgerus'];
    const jabatanOptions = ['Admin', 'CE Head'];
    const mengetahuiOptions = ['Ludgerus', 'Amin'];
  %>
  <!-- Container notifikasi -->
  <div id="notif" style="position: fixed; top: 20px; right: 20px; z-index: 1000;"></div>

  <form id="laporanForm" enctype="multipart/form-data" action="/laporan/add" method="POST">
    <div class="row">
      <label>Judul Laporan<input name="judul" required></label>
    </div>
    <div class="row">
      <label>Bulan <input name="month" required></label>
      <label>Minggu <input name="week" required></label>
      <label>Rentang Tanggal <input required type="text" name="rentang_tanggal" value="<%= laporan.rentang_tanggal || '' %>"></label>
      <label>Tahun <input name="year" required type="number" value="<%= new Date().getFullYear() %>"></label>
    </div>
    <div class="row">
      <label>Lokasi <input name="location" required></label>
      <label>Tanggal Laporan <input type="date" name="report_date" value="<%= new Date().toISOString().slice(0,10) %>"></label>
    </div>

    <h3>Daftar Pekerjaan</h3>
    <div id="itemsContainer"></div>
    <button type="button" class="btn" id="btnAddItem">+ Tambah Pekerjaan</button>

    <h3>Informasi pembangunan lainnya</h3>
    <textarea name="other_info" id="other_info" rows="5"><%= (laporan && laporan.other_info) ? laporan.other_info : '' %></textarea>

    <h3>Penutup</h3>
    <textarea name="penutup" rows="3"><%= laporan.penutup || '' %></textarea>

    <h3>Dibuat oleh</h3>
    <div class="row">
      <div class="col-6">
        <div class="form-group">
          <label for="created_by">Nama</label>
          <select id="created_by" name="created_by" required class="form-control">
            <% namaOptions.forEach(opt => { %>
              <option value="<%= opt %>"><%= opt %></option>
            <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label for="created_title">Jabatan</label>
          <select id="created_title" name="created_title" class="form-control">
            <% jabatanOptions.forEach(opt => { %>
              <option value="<%= opt %>"><%= opt %></option>
            <% }) %>
          </select>
        </div>
      </div>

      <div class="col-6">
        <div class="form-group">
          <label for="know">Mengetahui</label>
          <select id="know" name="know" class="form-control">
            <% mengetahuiOptions.forEach(opt => { %>
              <option value="<%= opt %>"><%= opt %></option>
            <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label for="jabatan">Jabatan</label>
          <select id="jabatan" name="jabatan" class="form-control">
            <% jabatanOptions.forEach(opt => { %>
              <option value="<%= opt %>"><%= opt %></option>
            <% }) %>
          </select>
        </div>
      </div>
    </div>


    <div style="margin-top:12px">
      <button class="btn primary" type="submit">Simpan</button>
      <a class="btn" href="/laporan">Batal</a>
    </div>

    <!-- Loader -->
    <div id="loader">
      <div>
        <div class="spinner"></div>
        <p>Menyimpan...</p>
      </div>
    </div>
  </form>
</section>

<style>
  #loader {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.7);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: bold;
  }
  #loader .spinner {
    border: 6px solid #f3f3f3;
    border-top: 6px solid #3498db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: auto;
  }
  #loader p {
    text-align: center;
    margin-top: 10px;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>

<%- include('partials/footer') %>
